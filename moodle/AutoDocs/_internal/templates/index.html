{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>Caplogy - Générateur de documents</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="{% static 'autodocs/home.css' %}" />
</head>
<body>
    <div class="main-flex-wrapper">
        <div class="caplogy-container">
            <div class="caplogy-header">
                <img src="{% static 'autodocs/logo.png' %}" alt="Logo Caplogy" />
                <h1>Caplogy</h1>
            </div>

            <form method="post" id="doc-form">
                {% csrf_token %}
                <label for="type_doc">Type de document :</label>
                <select id="type_doc" name="type_doc" required>
                    <option value="attestation_de_remise_de_materiel" {% if type_doc == "attestation_de_remise_de_materiel" %}selected{% endif %}>
                        Attestation de remise de matériel
                    </option>
                    <option value="attestation_employeur" {% if type_doc == "attestation_employeur" %}selected{% endif %}>
                        Attestation employeur
                    </option>
                    <option value="contrat_cdi" {% if type_doc == "contrat_cdi" %}selected{% endif %}>
                        Contrat CDI
                    </option>
                </select>

                <label for="prenom">Prénom :</label>
                <select id="prenom" name="prenom" required onchange="this.form.submit()">
                    <option value="">-- Choisir un prénom --</option>
                    {% for prenom in prenoms %}
                        <option value="{{ prenom }}" {% if prenom == select_prenom %}selected{% endif %}>{{ prenom }}</option>
                    {% endfor %}
                </select>

                <label for="nom">Nom :</label>
                <select id="nom" name="nom" required>
                    <option value="">-- Choisir un nom --</option>
                    {% for nom in noms %}
                        <option value="{{ nom }}" {% if nom == select_nom %}selected{% endif %}>{{ nom }}</option>
                    {% endfor %}
                </select>

                <button type="button" onclick="window.location.href='{% url 'creer_employer' %}'">
                    Créer un(e) nouvel(le) employé(e)
                </button>

                <input type="hidden" name="generate" value="0" />
                <button type="submit" name="action" value="preview">Preview</button>
            </form>
        </div>

        {% if error_message %}
            <p style="color: red; font-weight: bold;">{{ error_message }}</p>
        {% endif %}


        <div class="preview-panel">
            <h2>Prévisualisation</h2>

            {% if preview %}
                {% if type_doc == "contrat_cdi" %}
                    <p><strong>Civilité :</strong> {{ preview.civilite }}</p>
                    <p><strong>Nom :</strong> {{ preview.nom }}</p>
                    <p><strong>Prénom :</strong> {{ preview.prenom }}</p>
                    <p><strong>Date de naissance :</strong> {{ preview.date_de_naissance }}</p>
                    <p><strong>Lieu de naissance :</strong> {{ preview.lieu_de_naissance }}</p>
                    <p><strong>Nationalité :</strong> {{ preview.nationalite }}</p>
                    <p><strong>Adresse :</strong> {{ preview.adresse_maison }}</p>
                    <p><strong>Numéro de sécurité sociale :</strong> {{ preview.num_secu }}</p>
                    <p><strong>Titre de séjour :</strong> {{ preview.titre_sejour }}</p>
                    <p><strong>Numéro de séjour :</strong> {{ preview.num_sejour }}</p>
                    <p><strong>Date de validité du séjour :</strong> {{ preview.date_valable_sejour }}</p>
                    <p><strong>Poste :</strong> {{ preview.poste }}</p>
                    <p><strong>Salaire net :</strong> {{ preview.salaire_net }}</p>
                    <p><strong>Salaire brut annuel :</strong> {{ preview.salaire_brut }}</p>
                    <p><strong>Salaire brut mensuel :</strong> {{ preview.salaire_brut_mois }}</p>
                    <p><strong>Date du poste :</strong> {{ preview.date_poste }}</p>
                    <p><strong>Position :</strong> {{ preview.position }}</p>
                    <p><strong>Coefficient :</strong> {{ preview.coefficient }}</p>
                    <p><strong>Lieu de travail :</strong> {{ preview.lieu_de_travail }}</p>
                    <p><strong>Limitation géographique régionale :</strong> {{ preview.limit_geo_region }}</p>
                    <p><strong>Nom de l'entreprise :</strong> {{ preview.entreprise_nom }}</p>

                {% elif type_doc == "attestation_employeur" %}
                    <p><strong>Civilité :</strong> {{ preview.civilite }}</p>
                    <p><strong>Nom :</strong> {{ preview.nom }}</p>
                    <p><strong>Prénom :</strong> {{ preview.prenom }}</p>
                    <p><strong>Poste :</strong> {{ preview.poste }}</p>
                    <p><strong>Date du poste :</strong> {{ preview.date_poste  }}</p>
                    <p><strong>Entreprise :</strong> {{ preview.entreprise_nom }}</p>

                {% elif type_doc == "attestation_de_remise_de_materiel" %}
                    <p><strong>Civilité :</strong> {{ preview.civilite }}</p>
                    <p><strong>Nom :</strong> {{ preview.nom }}</p>
                    <p><strong>Prénom :</strong> {{ preview.prenom }}</p>
                    <p><strong>Poste :</strong> {{ preview.poste }}</p>
                    <p><strong>Matériel :</strong> {{ preview.marque }} - {{ preview.cpu }}</p>
                    <p><strong>N° Série :</strong> {{ preview.numero_serie }}</p>
                    <p><strong>RAM :</strong> {{ preview.ram }}</p>
                    <p><strong>Stockage :</strong> {{ preview.ssd }}</p>
                    <p><strong>Valeur Neuf :</strong> {{ preview.valeur_neuf }}</p>
                {% endif %}

                <form method="post" id="generate-form">
                    {% csrf_token %}
                    <input type="hidden" name="prenom" value="{{ preview.prenom }}">
                    <input type="hidden" name="nom" value="{{ preview.nom }}">
                    <input type="hidden" name="type_doc" value="{{ type_doc }}">
                    <input type="hidden" name="generate" value="1">
                    <button type="submit" name="action" value="generate">Accepter</button>
                </form>


            {% else %}
                <p>Aucune donnée à afficher.</p>
            {% endif %}
        </div>
    </div>

    <div class="caplogy-footer">
        &copy; {{ year|default:2025 }} Caplogy. Tous droits réservés.
    </div>
</body>
</html>
